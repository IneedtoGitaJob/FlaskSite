<!DOCTYPE html>
<html lang="en">
<head>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="../static/css/Css.css">
<title>Web Positivity</title>

</head>

<body id ="grad3">


<nav>
|<a href="/">Home</a>
|</nav>

<form>
    Input: <input type="text" name="input" id="Input"><br>
    <input type="radio" name="rad" id = "Website" checked="checked"> : Website<br>
    <input type="radio" name="rad" id = "News"> : News
    Number of years(oldest year is 2003): <input type="text" name="inputYears" id="yearsInput"><br>
    <!--<input type="radio" name="rad" id = "Tweets"> : Tweets<br>-->
    <input type="button" onclick="myFunction()" value="Submit" class = "button1">
</form>

<div class="chart-container">
    <canvas class = "Canvas" id="Canvas"></canvas>
</div>


</body>


<script>

//Checks a website for positivity and sets a color to match the positivity
function checkWeb(TextInput) 
{
    $.ajax({
  url: '/backgroundWebProcess',
  type: "POST",
  data: { 
          text: TextInput
        },
}).done(function( o ) {
    
    //Failed to connect
    if(o == "Fail")
    {
        alert("Failed to connect Improper request")
    }
    else
    {
        
        document.getElementById("Canvas").backgroundColor = o;
    }

});

}

//Checks Years of News Stories and returns a graph of the average positivity of each year
function checkManyWebs(TextInput, yearsInput)
{
    $.ajax({
  url: "/backgroundNewsProcess",
  type: "POST",
  data: { 
          text: TextInput,
          Years: yearsInput
        },
}).done(function( o ) {
    
alert(o)
var xValues = [];
for (let i = 0; i < yearsInput; i++) {
  xValues.push(i)
}

var yValues = o.split(' ').map(function(item) {
    return parseInt(item, 10);
});
alert(yValues)
new Chart("Canvas", {
  type: "line",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: "rgba(0,0,0,1.0)",
      borderColor: "rgba(0,0,0,0.1)",
      data: yValues
    }]
  },
  options: {responsive: false, maintainAspectRatio: true}
});


    
});
}

function myFunction() 
{
    var xValues = [5,6,7,8,9,10,11,12,13,14,15];
var yValues = [7,8,8,9,9,9,10,11,14,14,15];
    new Chart("Canvas", {
  type: "line",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: "rgba(0,0,0,1.0)",
      borderColor: "rgba(0,0,0,0.1)",
      data: yValues
    }]
  },
  options: {maintainAspectRatio: false}
});

    //Store inputs and check for valid inputs
    var TextInput = document.getElementById("Input").value;
    var RadioInput = document.querySelector('input[name="rad"]:checked').id
    var yearsInput = document.getElementById("yearsInput").value;

    //Clear inputs
    document.getElementById("Input").value = '';
    document.getElementById("yearsInput").value = '';

    //Use Inputs
        if(TextInput == "")
        {
            alert("No Input given")
        }
        else
        {

            if(RadioInput == "")
        {
            alert("No Selection given")
        }
        else
        {
            if(RadioInput == "Website")
            {
                checkWeb(TextInput) 
            }
            else
            {
                if(yearsInput != 0)
                {
                    checkManyWebs(TextInput, yearsInput)
                }
                else
                {
                    alert("No years input given")
                }
                
            }
        }


        }
        
    

}


</script>


</html>