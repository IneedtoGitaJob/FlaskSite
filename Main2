import win32api
from flask import Flask, render_template,request
from SearchNews import DisplayPositivity,GetNewsUrlsMulti,multiProcessList
import numpy as np
import json
import time

app = Flask(__name__)

#index
@app.route('/')
def index():
    return render_template('index.html')

#WebPositivity
@app.route('/WebPositivity')
def WebPositivity():
    return render_template('WebPositivity.html')

#Known Bugs
@app.route('/Issues')
def Issues():
    return ('Issues.html')

#Get Positivity Of a Website
@app.route('/backgroundWebProcess', methods=['POST'])
def backgroundWebProcess():
    URL = request.form["text"]
    return (DisplayPositivity(URL))

#Get Positivity of News stories
@app.route('/backgroundNewsProcessMulti', methods=['POST'])
def backgroundManyWebProcessMulti():
    searchTopic = request.form["text"]
    Years = request.form["Years"]
    urlList = GetNewsUrlsMulti(searchTopic, int(Years))
    averagePositivity = []
    start_time = time.time()
    q= []
    if __name__ == "__main__":
        for y in urlList:
                q = multiProcessList(y)
                print("q: " +str(q))
                q = [neg for neg in q if neg > 0]
                if(len(q) > 0):
                    averagePositivity.append(np.mean(q))
                else:
                    return("Fail")
    #print("---ProcessUrls: %s seconds ---" % (time.time() - start_time))
    return (" ".join(str(x) for x in averagePositivity))

if __name__ == "__main__":
    app.run(debug=True)
